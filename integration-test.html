<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiteBase Intelligence - Integration Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <div class="container mx-auto px-4 py-8 max-w-7xl">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-2">
                    üçΩÔ∏è BiteBase Intelligence Dashboard
                </h1>
                <p class="text-gray-600 text-lg">
                    Real-time restaurant analytics and insights - Full Integration Test
                </p>
            </div>

            <!-- Loading State -->
            <div id="loading" class="text-center py-12">
                <div class="loading border-4 border-blue-200 border-t-blue-600 rounded-full w-12 h-12 mx-auto mb-4"></div>
                <p class="text-gray-600">Loading dashboard data...</p>
            </div>

            <!-- Error State -->
            <div id="error" class="hidden bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
                <h3 class="text-red-800 font-semibold mb-2">‚ùå Connection Error</h3>
                <p id="error-message" class="text-red-600 mb-4"></p>
                <button onclick="loadData()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                    Retry
                </button>
            </div>

            <!-- Success Content -->
            <div id="content" class="hidden">
                <!-- System Status -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        üü¢ System Status
                    </h2>
                    <div id="health-status"></div>
                </div>

                <!-- Analytics Overview -->
                <div id="analytics-overview" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"></div>

                <!-- Weekly Revenue Chart -->
                <div id="weekly-revenue" class="bg-white rounded-lg shadow-md p-6 mb-8"></div>

                <!-- Peak Hours -->
                <div id="peak-hours" class="bg-white rounded-lg shadow-md p-6 mb-8"></div>

                <!-- Restaurant List -->
                <div id="restaurant-list" class="bg-white rounded-lg shadow-md p-6 mb-8"></div>

                <!-- AI Recommendations -->
                <div id="ai-recommendations" class="bg-white rounded-lg shadow-md p-6 mb-8"></div>

                <!-- Integration Status -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-2 flex items-center gap-2">
                        üß™ Integration Test Results
                    </h3>
                    <p class="text-gray-600 mb-4">Frontend-Backend communication status</p>
                    <div id="integration-status"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];

        async function testEndpoint(name, url, description) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                testResults.push({ name, description, status: 'PASSED', data });
                return data;
            } catch (error) {
                testResults.push({ name, description, status: 'FAILED', error: error.message });
                throw error;
            }
        }

        async function loadData() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('content').classList.add('hidden');
            testResults = [];

            try {
                // Test all endpoints
                const [health, restaurants, analytics, ai] = await Promise.all([
                    testEndpoint('Health Check', 'http://localhost:8000/health', 'Backend health status'),
                    testEndpoint('Restaurants API', 'http://localhost:8000/api/v1/restaurants', 'Restaurant data retrieval'),
                    testEndpoint('Analytics API', 'http://localhost:8000/api/v1/analytics/overview', 'Analytics overview data'),
                    testEndpoint('AI Recommendations', 'http://localhost:8000/api/v1/ai/recommendations', 'AI-powered recommendations')
                ]);

                // Render health status
                document.getElementById('health-status').innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <p class="text-green-600 font-medium">‚úÖ Backend: ${health.status}</p>
                        <p class="text-sm text-gray-600">
                            Service: ${health.service} | Version: ${health.version} | 
                            Timestamp: ${health.timestamp}
                        </p>
                    </div>
                `;

                // Render analytics overview
                const analyticsData = analytics.data;
                document.getElementById('analytics-overview').innerHTML = `
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 mb-1">Total Revenue</p>
                                <p class="text-3xl font-bold text-gray-900">$${analyticsData.revenue.total.toLocaleString()}</p>
                                <p class="text-sm text-green-600">+${analyticsData.revenue.monthly_growth}% from last month</p>
                            </div>
                            <div class="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center text-2xl">üí∞</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 mb-1">Total Customers</p>
                                <p class="text-3xl font-bold text-gray-900">${analyticsData.customers.total.toLocaleString()}</p>
                                <p class="text-sm text-blue-600">+${analyticsData.customers.growth_rate}% growth rate</p>
                            </div>
                            <div class="h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center text-2xl">üë•</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 mb-1">Total Orders</p>
                                <p class="text-3xl font-bold text-gray-900">${analyticsData.orders.total.toLocaleString()}</p>
                                <p class="text-sm text-purple-600">Avg: $${analyticsData.orders.average_order_value}</p>
                            </div>
                            <div class="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center text-2xl">üõí</div>
                        </div>
                    </div>
                `;

                // Render weekly revenue
                const weeklyHtml = analyticsData.revenue.weekly_data.map(week => 
                    `<div class="p-4 bg-gray-50 rounded-lg">
                        <div class="text-sm font-medium text-gray-600">${week.week}</div>
                        <div class="text-2xl font-bold text-gray-900">$${week.revenue.toLocaleString()}</div>
                    </div>`
                ).join('');
                document.getElementById('weekly-revenue').innerHTML = `
                    <h3 class="text-xl font-semibold mb-2">Weekly Revenue Breakdown</h3>
                    <p class="text-gray-600 mb-4">Revenue performance by week</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">${weeklyHtml}</div>
                `;

                // Render peak hours
                const peakHoursHtml = analyticsData.orders.peak_hours.map(hour => 
                    `<div class="text-center p-4 bg-orange-50 rounded-lg">
                        <div class="text-lg font-bold text-orange-600">${hour}</div>
                        <div class="text-sm text-gray-600">Peak Hour</div>
                    </div>`
                ).join('');
                document.getElementById('peak-hours').innerHTML = `
                    <h3 class="text-xl font-semibold mb-2">Peak Hours</h3>
                    <p class="text-gray-600 mb-4">Busiest times for orders</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">${peakHoursHtml}</div>
                `;

                // Render restaurant list
                const restaurantHtml = restaurants.data.slice(0, 5).map(restaurant => 
                    `<div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-900">${restaurant.name}</h3>
                            <p class="text-sm text-gray-600">${restaurant.address}</p>
                            <div class="flex items-center gap-4 mt-2">
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${restaurant.category}</span>
                                <span class="text-xs text-gray-500">${restaurant.cuisine_types.join(', ')}</span>
                                <span class="text-xs text-gray-500">${restaurant.price_range}</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-yellow-500">‚≠ê</span>
                                <span class="font-medium">${restaurant.average_rating || 'N/A'}</span>
                            </div>
                            <p class="text-sm text-gray-600">${restaurant.total_reviews} reviews</p>
                            <p class="text-xs text-green-600 font-medium">$${restaurant.estimated_revenue?.toLocaleString() || 'N/A'} revenue</p>
                        </div>
                    </div>`
                ).join('');
                document.getElementById('restaurant-list').innerHTML = `
                    <h3 class="text-xl font-semibold mb-2">Active Restaurants</h3>
                    <p class="text-gray-600 mb-4">Your restaurant network (${restaurants.data.length} total)</p>
                    <div class="space-y-4">${restaurantHtml}</div>
                `;

                // Render AI recommendations
                let aiHtml = '';
                const aiData = ai.data;
                
                // Menu optimization
                if (aiData.menu_optimization) {
                    aiHtml += '<h4 class="font-semibold mb-2">üìä Menu Optimization</h4>';
                    aiData.menu_optimization.forEach(rec => {
                        aiHtml += `<div class="p-4 border rounded-lg mb-3">
                            <p class="font-medium">${rec.item}: ${rec.recommendation}</p>
                            <p class="text-sm text-gray-600">${rec.reasoning}</p>
                            <p class="text-sm text-green-600">Impact: ${rec.potential_impact}</p>
                        </div>`;
                    });
                }
                
                // Operational insights
                if (aiData.operational_insights) {
                    aiHtml += '<h4 class="font-semibold mb-2 mt-4">‚öôÔ∏è Operational Insights</h4>';
                    aiData.operational_insights.forEach(rec => {
                        aiHtml += `<div class="p-4 border rounded-lg mb-3">
                            <p class="font-medium">${rec.area}: ${rec.recommendation}</p>
                            <p class="text-sm text-blue-600">Impact: ${rec.impact}</p>
                        </div>`;
                    });
                }
                
                // Marketing suggestions
                if (aiData.marketing_suggestions) {
                    aiHtml += '<h4 class="font-semibold mb-2 mt-4">üì± Marketing Suggestions</h4>';
                    aiData.marketing_suggestions.forEach(rec => {
                        aiHtml += `<div class="p-4 border rounded-lg mb-3">
                            <p class="font-medium">${rec.channel}: ${rec.action}</p>
                            <p class="text-sm text-purple-600">Expected ROI: ${rec.expected_roi}</p>
                        </div>`;
                    });
                }
                document.getElementById('ai-recommendations').innerHTML = `
                    <h3 class="text-xl font-semibold mb-2">ü§ñ AI Recommendations</h3>
                    <p class="text-gray-600 mb-4">Intelligent insights for your business</p>
                    <div>${aiHtml}</div>
                `;

                // Render integration status
                const statusHtml = testResults.map(result => 
                    `<div class="flex items-center gap-2">
                        <span class="text-${result.status === 'PASSED' ? 'green' : 'red'}-500">
                            ${result.status === 'PASSED' ? '‚úÖ' : '‚ùå'}
                        </span>
                        <span>${result.description}: ${result.status}</span>
                    </div>`
                ).join('');
                document.getElementById('integration-status').innerHTML = `
                    <div class="space-y-2">
                        ${statusHtml}
                        <div class="mt-4 p-3 bg-green-50 rounded-lg">
                            <p class="text-green-800 font-medium">üéâ SUCCESS: Full Integration Working!</p>
                            <p class="text-green-600 text-sm mt-1">All API endpoints are responding correctly and real-time data is being displayed.</p>
                        </div>
                    </div>
                `;

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');

            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = error.message || 'Failed to load dashboard data';
            }
        }

        // Load data when page loads
        window.addEventListener('load', loadData);
    </script>
</body>
</html>